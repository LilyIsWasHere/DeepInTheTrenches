[gd_scene load_steps=5 format=3 uid="uid://b438djrjx0hs4"]

[ext_resource type="PackedScene" uid="uid://b4msqubryiixn" path="res://Terrain.tscn" id="3_ohhpf"]
[ext_resource type="Script" uid="uid://bsouf48aos0dn" path="res://scripts/label_3d.gd" id="7_56f15"]

[sub_resource type="Shader" id="Shader_3vi8l"]
resource_local_to_scene = true
code = "shader_type canvas_item;

uniform vec2 offset;
uniform int size;

uniform float small_scale;
uniform float large_scale;

uniform float small_intensity=1.0;
uniform float large_intensity=1.0;

vec3 permute(vec3 x) { return mod(((x*34.0)+1.0)*x, 289.0); }

float snoise(vec2 v){
  const vec4 C = vec4(0.211324865405187, 0.366025403784439,
           -0.577350269189626, 0.024390243902439);
  vec2 i  = floor(v + dot(v, C.yy) );
  vec2 x0 = v -   i + dot(i, C.xx);
  vec2 i1;
  i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);
  vec4 x12 = x0.xyxy + C.xxzz;
  x12.xy -= i1;
  i = mod(i, 289.0);
  vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))
  + i.x + vec3(0.0, i1.x, 1.0 ));
  vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy),
    dot(x12.zw,x12.zw)), 0.0);
  m = m*m ;
  m = m*m ;
  vec3 x = 2.0 * fract(p * C.www) - 1.0;
  vec3 h = abs(x) - 0.5;
  vec3 ox = floor(x + 0.5);
  vec3 a0 = x - ox;
  m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );
  vec3 g;
  g.x  = a0.x  * x0.x  + h.x  * x0.y;
  g.yz = a0.yz * x12.xz + h.yz * x12.yw;
  return 130.0 * dot(m, g);
}


float hills(vec2 uv, int tile_size, vec2 tile_offset) {
	vec2 sample = (uv * float(size)) + offset;

	float small_noise = ((snoise(sample * small_scale * 0.001) + 1.0)/2.0) * small_intensity;
	float large_noise = ((snoise(sample * large_scale * 0.001) + 1.0)/2.0) * large_intensity;

	return  small_noise + large_noise;
}

void fragment() {

	float height = hills(UV, size, offset);
	COLOR = vec4(height, 0, 0, 1);

}"

[sub_resource type="ShaderMaterial" id="ShaderMaterial_8rhti"]
resource_local_to_scene = true
shader = SubResource("Shader_3vi8l")
shader_parameter/offset = Vector2(0, 0)
shader_parameter/size = 500
shader_parameter/small_scale = 2.0
shader_parameter/large_scale = 0.8
shader_parameter/small_intensity = 0.2
shader_parameter/large_intensity = 1.5

[node name="Node3D" type="Node3D"]

[node name="Camera3D" type="Camera3D" parent="."]
transform = Transform3D(-0.66898173, 0.2043073, -0.7146482, 0, 0.96148056, 0.27487302, 0.74327886, 0.18388502, -0.6432129, -48.609924, 81.514824, -53.612064)

[node name="Label3D" type="Label3D" parent="Camera3D"]
transform = Transform3D(1, -6.7055225e-08, 2.9802322e-08, 0, 1, 1.1920929e-07, 0, -2.9802322e-08, 0.9999999, -0.6081147, 0.3632822, -0.60115767)
text = "FPS: "
font_size = 10
outline_size = 5
script = ExtResource("7_56f15")

[node name="DirectionalLight3D" type="DirectionalLight3D" parent="."]
transform = Transform3D(-0.67469615, 0.3339157, -0.65824425, 0, 0.89181435, 0.45240167, 0.7380956, 0.30523363, -0.60170364, -165.5405, 138.63272, 283.12396)

[node name="Terrain" parent="." instance=ExtResource("3_ohhpf")]
transform = Transform3D(0.1, 0, 0, 0, 0.1, 0, 0, 0, 0.1, 0, 0, 0)
num_tiles = Vector2i(8, 8)
heightmap_gen_material = SubResource("ShaderMaterial_8rhti")
